name: Clash-for-Windows Update Check

on:
  schedule: 
    - cron: '0 2/2 * * *'

  workflow_dispatch:


jobs:
  update:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - name: Install requirements
      run: pip install requests python-dotenv

    - name: Run Python Script
      run: 
        python clash.py
        
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.PAT }} #此处PAT需要申请，教程详见：https://www.jianshu.com/p/bb82b3ad1d11,需要repo和workflow权限
    - name: change variables
      run: |
          
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "change var"
          git push origin master
env:
  TG_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
  TG_CHAT_ID: ${{ secrets.CHANNEL_ID }}
